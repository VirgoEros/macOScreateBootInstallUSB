(* 
bit.ly/ä¸‹è¼‰_é±«é°°macOSé–‹æ©Ÿé°ˆé±®ISOé¯¯ä½œ_dmg 
GitHub.com/VirgoEros/macOScreateBootInstallUSB/blob/master/AppleScript 
*) 
-----------------------âˆ é±«é°°macOSé–‹æ©Ÿé°ˆé±®ISOé¯¯ä½œ âˆ------------------------------ON. 
global macOSBoot, macOSBootISO, macOSBootUSB_BackgroundProcessing, errmsg, errnbr
global macOSBootUSB_BackgroundProcessing, InstallmacOS, ErosDestUSB, CreateInstallMedia, NewVersion, OldVersion, inBackground, BackgroundProcessing, isDone, itemPath, itemProgress, TerminalNotifier, errmsg, errnbr
global macOSBootISO, InstallmacOS, ISOsize, VolumesEros, InstallmacOSpath, CreateInstallMedia, InstallmacOSname, InstallmacOSnameExtension, inBackground, TerminalNotifier, isDone, itemPath, itemProgress, errmsg, errnbr
global OpenScript, OpenAppScript, TerminalNotifier, errmsg, errnbr

on run
	try
		tell application "Finder" to set {button returned:macOSBoot} to Â¬
			display dialog ("
è«‹é°›é°‡é±®ç¾é±ºæ²ç™‚ç™’é¯€å¥³é°°é¸æ“‡æ¬²é¯¯ä½œ é–‹æ©Ÿé°ˆ æˆ– ISO å”·ğŸ’‹") buttons Â¬
				{"é–‹æ©Ÿé°ˆ", "ISO", "é–‹å•ŸmacOSé–‹æ©Ÿé°ˆé±®ISOé¯¯ä½œè…³æœ¬"} with title Â¬
				{"é±«é°°macOSé–‹æ©Ÿé°ˆé±®ISOé¯¯ä½œ"}
		if macOSBoot is "é–‹æ©Ÿé°ˆ" then run script macOSBootUSB_BackgroundProcessing
		if macOSBoot is "ISO" then run script macOSBootISO
		if macOSBoot is "é–‹å•ŸmacOSé–‹æ©Ÿé°ˆé±®ISOé¯¯ä½œè…³æœ¬" then run script OpenScript
	on error errmsg number errnbr
		if errnbr = -128 then continue quit
		continue quit
	end try
end run
---------------------âˆ é±«é°°macOSé–‹æ©Ÿé°ˆé¯¯ä½œ âˆ----------------------------ON. 
script macOSBootUSB_BackgroundProcessing
	try
		tell application "Finder"
			set InstallmacOS to Â¬
				POSIX path of (choose file with prompt {" 
è«‹é°›é°‡é±®ç¾é±ºæ²ç™‚ç™’é¯€å¥³é°°é¸æ“‡æ¬²é¯¯ä½œé–‹æ©Ÿé°ˆä¹‹macOSä¾†æºç‰ˆæœ¬å”·ğŸ’‹"} default location (path to (applications folder)))
			
			set ErosDestUSB to Â¬
				quoted form of POSIX path of (choose folder with prompt {" 
è«‹é°›é°‡é±®ç¾é±ºæ²ç™‚ç™’é¯€å¥³é°°é¸æ“‡æ¬²é¯¯ä½œé–‹æ©Ÿé°ˆä¹‹ç›®æ¨™USBå”·ğŸ’‹"} default location (path to (startup disk)))
			
			set CreateInstallMedia to quoted form of (InstallmacOS & "Contents/Resources/createinstallmedia")
			set NewVersion to (CreateInstallMedia & " --volume ")
			set InstallmacOS to quoted form of InstallmacOS
			set OldVersion to (" --applicationpath " & InstallmacOS & " --nointeraction")
			set inBackground to " &> /dev/null &"
			set BackgroundProcessing to NewVersion & ErosDestUSB & OldVersion & inBackground
			(do shell script BackgroundProcessing with administrator privileges)
			delay 1
			set isDone to false
			set itemPath to ("createinstallmedia")
			set itemProgress to "ps ax | grep -v grep | grep " & itemPath
			repeat while isDone is false
				try
					do shell script itemProgress
					if the result contains itemPath then
						delay 1
					else
						set isDone to true
					end if
				on error
					set isDone to true
				end try
			end repeat
			if isDone is true then
				set TerminalNotifier to POSIX path of (path to me as text) Â¬
					& {"Contents/MacOS/terminal-notifier"}
				set TerminalNotifier to quoted form of TerminalNotifier
				do shell script (TerminalNotifier & " -title é–‹æ©Ÿé°ˆé¯¯ä½œé¯‡æˆé°³å”·ğŸ’‹")
				delay 1
				do shell script ("open " & ErosDestUSB)
				continue quit
			end if
		end tell
	on error errmsg number errnbr
		if errnbr = -128 then continue quit
		continue quit
	end try
end script
---------------------------âˆ é±«é°°macOS ISOé¯¯ä½œ âˆ-----------------------------------ON. 
script macOSBootISO
	try
		tell application "Finder"
			display dialog ("
è«‹æ²å¥³é°°ç§»é™¤æ‰€æœ‰å¤–é¯œç£é°ˆå†ä²€è¡Œå”·ğŸ’‹ 
é¯‡æˆå¾Œé± é¯²æ¡Œé¢ä¸Šé¡¯ä±ˆå‰¯æª”åğ©»Ÿ iso çš„æª”æ¡ˆå”·ğŸ’‹ 
ç­‰å¾…é¯‡æˆé¯½é­ºå”·ğŸ’‹") with title Â¬
				{"macOS ISOé¯¯ä½œ"}
			
			set InstallmacOS to Â¬
				(choose file with prompt {"
è«‹é°›é°‡é±®ç¾é±ºæ²ç™‚ç™’é¯€å¥³é°°é¸æ“‡æ¬²é¯¯ä½œISOä¹‹macOSä¾†æºç‰ˆæœ¬å”·ğŸ’‹"} default location (path to (applications folder)))
			
			set ISOsize to InstallmacOS's size as string
			set ISOsize to characters 4 thru 1 of ISOsize
			set VolumesEros to quoted form of ("/Volumes/é±«é°°")
			set InstallmacOSpath to POSIX path of InstallmacOS
			set CreateInstallMedia to quoted form of (InstallmacOSpath & "Contents/Resources/createinstallmedia")
			set InstallmacOSname to InstallmacOS's name as string
			set InstallmacOSname to text 1 thru ((offset of "." in InstallmacOSname) - 1) of InstallmacOSname
			set InstallmacOSnameExtension to quoted form of (InstallmacOSname & ".iso")
			set InstallmacOSname to quoted form of InstallmacOSname
			set InstallmacOSpath to quoted form of InstallmacOSpath
			set inBackground to " &> /dev/null &"
			do shell script "open " & quoted form of ("/Applications/Install macOS Catalina.app")
			tell application "System Events" to key code (55 & 12)
			{do shell script " 
hdiutil create -o /tmp/macOS.cdr -size " & ISOsize & "gb -layout SPUD -fs HFS+J ; 
hdiutil attach /tmp/macOS.cdr.dmg -noverify -mountpoint " & VolumesEros & " ; 
" & CreateInstallMedia & " --volume " & VolumesEros & " --applicationpath " & InstallmacOSpath & " --nointeraction ;  
hdiutil detach /Volumes/" & InstallmacOSname & " ; 
hdiutil convert /tmp/macOS.cdr.dmg -format UDTO -o /tmp/macOS.iso ; 
mv /tmp/macOS.iso.cdr ~/Desktop/" & InstallmacOSnameExtension & " ; 
rm /tmp/macOS.cdr.dmg ; " & inBackground with administrator privileges}
			delay 1
			set isDone to false
			set itemPath to ("/tmp/macOS.iso")
			set itemProgress to "ps ax | grep -v grep | grep " & itemPath
			repeat while isDone is false
				try
					do shell script itemProgress
					if the result contains itemPath then
						delay 1
					else
						set isDone to true
					end if
				on error
					set isDone to true
				end try
			end repeat
			if isDone is true then
				set TerminalNotifier to POSIX path of (path to me as text) Â¬
					& {"Contents/MacOS/terminal-notifier"}
				set TerminalNotifier to quoted form of TerminalNotifier
				do shell script (TerminalNotifier & " -title ISOé¯¯ä½œé¯‡æˆé°³å”·ğŸ’‹")
				continue quit
			end if
		end tell
	on error errmsg number errnbr
		if errnbr = -128 then continue quit
		continue quit
	end try
end script
------------------------ é–‹å•Ÿé±«é°°macOSé–‹æ©Ÿé°ˆé±®ISOé¯¯ä½œè…³æœ¬ ------------------------ON. 
script OpenScript
	try
		set OpenAppScript to POSIX path of (path to me as text) & ("Contents/Resources/Scripts/main.scpt")
		set OpenAppScript to quoted form of OpenAppScript
		do shell script ("open " & OpenAppScript)
		set TerminalNotifier to POSIX path of (path to me as text) & ("Contents/MacOS/terminal-notifier")
		set TerminalNotifier to quoted form of TerminalNotifier
		do shell script (TerminalNotifier & " -title è…³æœ¬å·²é–‹å•Ÿé°³å”·ğŸ’‹")
		continue quit
	on error errmsg number errnbr
		if errnbr = -128 then continue quit
		continue quit
	end try
end script
--ğŸ’‹ ErosLove JuliaComputing.com ğŸ’‹ 
-------------------------âˆ é±«é°°macOSé–‹æ©Ÿé°ˆé±®ISOé¯¯ä½œ âˆ---------------------------END. 


-- 
